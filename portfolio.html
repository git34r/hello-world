<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Bonpit</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sora:wght@100..800&display=swap');
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sora', sans-serif;
            background-color: #000000;
            color: #ffffff;
            line-height: 1.6;
            padding: 140px 20px 40px;
            min-height: 100vh;
        }
        
        #top-dock {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 28px;
            display: flex;
            align-items: center;
            gap: 22px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 999px;
            z-index: 250;
        }
        
        #top-dock a {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 1px;
            text-decoration: none;
            text-transform: lowercase;
            color: #ffffff;
            opacity: 0.75;
            transition: opacity 0.2s ease;
        }
        
        #top-dock a:hover {
            opacity: 1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 60px;
        }

        h1 {
            font-size: 32px;
            font-weight: 300;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            grid-auto-rows: 4px;
            grid-auto-flow: dense;
            align-items: start;
            gap: 0;
            max-width: 1200px;
            margin: 0 auto;
        }

        .media-tile {
            position: relative;
            display: flex;
            flex-direction: column;
            background: #000000;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 6px;
            overflow: hidden;
        }

        .tile-media {
            position: relative;
            width: 100%;
            flex-shrink: 0;
        }

        .image-tile .tile-media {
            padding-top: 100%;
        }

        .video-tile .tile-media {
            position: relative;
        }

        .tile-media img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            display: block;
            border: none;
            object-fit: cover;
        }

        .tile-media iframe {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            display: block;
            border: none;
        }

        .tile-label {
            margin-top: 6px;
            font-size: 0.72rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: rgba(255, 255, 255, 0.7);
            height: 1.2em;
            line-height: 1.2em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-shrink: 0;
        }

        .video-placeholder {
            position: absolute;
            inset: 0;
            background-color: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-tile .tile-media.loaded .video-placeholder {
            display: none;
        }

        @media (max-width: 768px) {
            body {
                padding: 120px 15px 40px;
            }
            
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <nav id="top-dock">
        <a href="https://bonpit.com/releases" target="_blank" rel="noopener">releases</a>
        <a href="https://bonpit.com/vapestream" target="_blank" rel="noopener">watch vapemodel</a>
        <a href="https://bonpit.com/portfolio" target="_blank" rel="noopener">portfolio</a>
        <a href="mailto:admin@bonpit.com">contact</a>
    </nav>
    <div class="container">
        <header>
            <h1>Portfolio</h1>
        </header>
        <div class="media-grid" id="mediaGrid" aria-live="polite"></div>
    </div>

    <script>
        const githubRepo = 'https://raw.githubusercontent.com/git34r/hello-world/main/port';
        const githubApi = 'https://api.github.com/repos/git34r/hello-world/contents/port';
        const vimeoVideos = [
            { id: '1135590890', title: 'ONNYCHO_PACKSNRACK' },
            { id: '1135590836', title: 'OBS_SINGLES' },
            { id: '1135590791', title: 'OBSVA4' },
            { id: '1135590728', title: 'OBSVA5' },
            { id: '1135590687', title: 'AW_EVENT01' },
            { id: '1135590630', title: 'AW_EVENT02' }
        ];
        const vimeoToken = 'f0d6033eb5ee23b75c34776c69069a66';

        const grid = document.getElementById('mediaGrid');
        const ROW_HEIGHT = 4;
        const GAP = 0;

        const resizeObserver = new ResizeObserver(entries => {
            entries.forEach(entry => updateRowSpan(entry.target));
        });

        function updateRowSpan(tile) {
            if (!tile) return;
            const height = tile.getBoundingClientRect().height;
            const span = Math.max(1, Math.ceil((height + GAP) / (ROW_HEIGHT + GAP)));
            tile.style.gridRowEnd = `span ${span}`;
        }

        function mapImageName(originalName) {
            const nameMap = {
                'bonpitdallaniel': 'BONPIT&DALLANIEL_IMB01',
                'coveremilioeuphrat': 'EMILIOALBERT&EUPHRAT_MOURINGROUTINES',
                'dallanielgrooveidcover': 'DALLANIEL_GROOVEID',
                'dallaniel_grooveid': 'DALLANIEL_GROOVEID',
                'dallanielukg': 'DALLANIEL_<3BEAT',
                'emilioalbertmodalities': 'EMILIOALBERT_MODALITIES',
                'modalities': 'EMILIOALBERT_MODALITIES',
                'emilioalbert_modalities': 'EMILIOALBERT_MODALITIES',
                'syndicate allstars': 'SYNDIKAET_ALLSTARS',
                'syndicateallstars': 'SYNDIKAET_ALLSTARS',
                'syndikaet': 'SYNDIKAET_ALLSTARS',
                'syndikaet_allstars': 'SYNDIKAET_ALLSTARS',
                'allstars': 'SYNDIKAET_ALLSTARS',
                'individuation': 'DALLANIEL_INDIVIDUATION'
            };
            
            // Remove extension and convert to lowercase for matching
            const nameWithoutExt = originalName.replace(/\.[^/.]+$/, '').toLowerCase();
            const nameWithExt = originalName.toLowerCase();
            
            // Try exact match first
            let mapped = nameMap[nameWithoutExt] || nameMap[nameWithExt];
            
            // If no exact match, try partial matching for keywords
            if (!mapped) {
                const lowerName = nameWithoutExt;
                if (lowerName.includes('modalities')) {
                    mapped = 'EMILIOALBERT_MODALITIES';
                } else if (lowerName.includes('allstars') || lowerName.includes('syndikaet') || lowerName.includes('syndicate')) {
                    mapped = 'SYNDIKAET_ALLSTARS';
                } else if (lowerName.includes('individuation')) {
                    mapped = 'DALLANIEL_INDIVIDUATION';
                }
            }
            
            return mapped || originalName.toUpperCase();
        }

        function formatLabel(name) {
            const mappedName = mapImageName(name);
            // Always preserve underscores and other characters, don't replace with spaces
            return mappedName;
        }

        async function fetchImageList() {
            try {
                const response = await fetch(githubApi);
                if (!response.ok) throw new Error('image listing failed');
                const files = await response.json();
                return files
                    .filter(file => file.type === 'file' && /\.(jpg|jpeg|png|gif|webp)$/i.test(file.name) && file.name.toLowerCase() !== 'logo.png')
                    .map(file => ({
                        type: 'image',
                        label: file.name,
                        path: `${githubRepo}/${file.name}`
                    }))
                    .sort((a, b) => a.label.localeCompare(b.label));
            } catch (error) {
                console.error(error);
                return [];
            }
        }

        async function fetchVideoMeta(id) {
            try {
                const response = await fetch(`https://api.vimeo.com/videos/${id}`, {
                    headers: {
                        'Authorization': `Bearer ${vimeoToken}`
                    }
                });
                if (!response.ok) throw new Error('vimeo lookup failed');
                const video = await response.json();
                return {
                    width: video.width || 1080,
                    height: video.height || 1920,
                    title: video.name || `vimeo ${id}`
                };
            } catch (error) {
                console.warn(`Could not load Vimeo metadata for ${id}`, error);
                return {
                    width: 1080,
                    height: 1920,
                    title: `vimeo ${id}`
                };
            }
        }

        async function buildVideoList() {
            const list = [];
            for (const video of vimeoVideos) {
                const meta = await fetchVideoMeta(video.id);
                list.push({
                    type: 'video',
                    label: video.title || meta.title,
                    path: `https://player.vimeo.com/video/${video.id}?background=1&autoplay=1&loop=1&muted=1&controls=0&title=0&byline=0&portrait=0&dnt=1`,
                    width: meta.width,
                    height: meta.height
                });
            }
            return list;
        }

        function createImageTile(item) {
            const tile = document.createElement('article');
            tile.className = 'media-tile image-tile';
            tile.setAttribute('tabindex', '0');
            tile.setAttribute('aria-label', `image ${item.label}`);

            const media = document.createElement('div');
            media.className = 'tile-media';

            const img = new Image();
            img.src = item.path;
            img.alt = item.label;
            img.loading = 'lazy';
            img.decoding = 'async';
            img.addEventListener('load', () => {
                requestAnimationFrame(() => updateRowSpan(tile));
            });

            media.appendChild(img);
            tile.appendChild(media);

            const label = document.createElement('span');
            label.className = 'tile-label';
            label.textContent = formatLabel(item.label);
            tile.appendChild(label);

            return tile;
        }

        function createVideoTile(item) {
            const tile = document.createElement('article');
            tile.className = 'media-tile video-tile';
            tile.setAttribute('tabindex', '0');
            tile.setAttribute('aria-label', `video ${item.label}`);

            const media = document.createElement('div');
            media.className = 'tile-media';
            
            // Calculate aspect ratio and set padding-top
            const aspectRatio = (item.height / item.width) * 100;
            media.style.paddingTop = `${aspectRatio}%`;

            // Create placeholder
            const placeholder = document.createElement('div');
            placeholder.className = 'video-placeholder';
            media.appendChild(placeholder);

            const iframe = document.createElement('iframe');
            iframe.src = item.path;
            iframe.title = item.label;
            iframe.allow = 'autoplay; fullscreen; picture-in-picture';
            iframe.setAttribute('allowfullscreen', '');
            iframe.style.opacity = '0';
            iframe.style.transition = 'opacity 0.3s ease-in';
            iframe.addEventListener('load', () => {
                requestAnimationFrame(() => {
                    updateRowSpan(tile);
                    iframe.style.opacity = '1';
                    media.classList.add('loaded');
                });
            });

            media.appendChild(iframe);
            tile.appendChild(media);

            const label = document.createElement('span');
            label.className = 'tile-label';
            label.textContent = formatLabel(item.label);
            tile.appendChild(label);

            return tile;
        }

        function appendTile(tile) {
            if (!grid || !tile) return;
            grid.appendChild(tile);
            resizeObserver.observe(tile);
            requestAnimationFrame(() => updateRowSpan(tile));
        }

        async function initRaster() {
            if (!grid) return;
            const [images, videos] = await Promise.all([
                fetchImageList(),
                buildVideoList()
            ]);

            const items = [...images, ...videos];

            for (const item of items) {
                const tile = item.type === 'image'
                    ? createImageTile(item)
                    : createVideoTile(item);
                appendTile(tile);
            }
        }

        initRaster();
    </script>
</body>
</html>

